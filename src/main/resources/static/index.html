<!DOCTYPE html>
<html lang="da">
	<head>
		<title>Map</title>
		<meta content="Text/html" charset="utf-8" lang="da" />
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	    crossorigin=""/>
	    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	    crossorigin=""></script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
			  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
				integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

	</head>
	<body class="container">
	<script src="showAndHide.js"></script>

	<br/>
	<h1 class="h1"> Christians &Oslash; eksamensprojekt</h1>
	<br/>

	<ul>
		<li><a class="active" href="index.html" accesskey="k">Kort / index</a></li>
		<li><a href="login.html" accesskey="a">Admin</a></li>
		<li><a href="aboutUs.html" accesskey="o">Om os</a></li>
	</ul>


	<table class="table">
		<tr>
			<td id="menu" rowspan="2">
				<h2 class="h1">Menu</h2>

				<div id="tour-div">
					<div id="tours-header-index" onclick="showTours()" aria-colspan="2">
						<h2 class="h2" id="tours-header">Tours &darr;</h2>
					</div>
					<br><br>
                    <div id="tour-content">
                        <label for="interestPoints">Choose an interest point:</label>
                        <select name="interest-Points" id="interestPoints" style="width: 30.5%">
                            <option value="bygning">Bygninger</option>
                            <option value="natur">Natur</option>
                            <option value="spøgelser">Spørgelser</option>
                            <option value="sos">SOS</option>
                            <option value="skrald">Skrald</option>
                            <option value="krig">Krig</option>
                        </select>
                        <table id="tour-table" class="table">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Navn</th>
                                <th>Beskrivelse</th>
                                <th>max Deltagere</th>
                                <th>Varighed</th>
                            </tr>
                            </thead>
                            <tbody id="tour-table-body"></tbody>
                        </table>
                    </div>
				</div>
				<br/>
				<div id="route-div" style="overflow: scroll">
					<div id="route-header-index">
					<h2 class="h2"> Routes</h2>
					</div>
					<div id="route-content">
					<button id="route-edit" onclick="enableRouteEdit()" class="btn btn-primary">Ny Rute</button>
					<table id="route-list">
						<tr id="route0">
							<td>Rute 0</td>
							<td>
								<button id="route0Button" onclick="showRoute(0)" class="btn btn-primary">Vis</button>
							</td>
						</tr>
					</table>
					</div>
				</div>
				<br/>

				<div id="attraction-div">
					<div id="attraction-header-index" onclick="showAttractions()">
					<h2 class="h2" id="attraction-header">Attractions &darr;</h2>
					</div>
						<div id="attraction-content">
					<table id="attraction-table-index" class="table">
						<thead>
						<tr>
							<th>Info</th>
							<th style="width: 35px">Navn</th>
							<th>Interesse emner</th>
							<th>Estimeret tid til båden</th>
						</tr>
						</thead>
						<tbody id="attraction-table-body-index"></tbody>
					</table>
					</div>
				</div>
				<br/>
				<div id="boatDiv">
					<h2 class="h2"> Tid til b&aring;den kommer</h2>
					<label> Hvorn&aring;r ankom du med f&aelig;rgen</label>
					<input id="boatTimeInput" type="time">
					<button onclick="calculateTime()">Godkend</button>
					<br/>
					<h2>Tid til afgang: <label id="countDown"></label></h2>
				</div>
			</td>


			<td><div id="map"></div></td>
			</tr><tr>
			<td id="data-cell"></td>
		</tr>
	</table>

	<div class="modal fade" id="attraction-modal-index" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">

				<div class="modal-header">

					<h5 class="modal-title" id="attraction-name">Attraction title</h5>
					<p id="attraction-timeToBoat"></p>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>


				</div>

				<div class="modal-body">
					<div class="mb-3">
						<div id="attraction-description"></div>
						<div id="attraction-interestPoints"></div>
						<div id="attraction-map"></div>
						<!--<div id="attraction-timeToBoat"></div>-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Luk</button>

				</div>
			</div>
		</div>
	</div>
	</body>

	<script src="Tour.js"></script>
	<script src="TourOverride.js"></script>

	<script src="Attraction.js" type="module"></script>

    <script>

        //UDREGNING AF AFGANG AFHÆNGIG AF ANKOMST
        let departure
        function calculateTime(){
            clearInterval()
            let inputTime=document.getElementById("boatTimeInput").value
            let arival=parseTime(inputTime)
            departure=new Date(new Date(arival).setHours(new Date(arival).getHours()+3))
            setInterval(()=>{
                let timeLeft = departure - new Date()
                let hours = String(Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2,"0")
                let minutes = String(Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60))).padStart(2,"0")
                let seconds = String(Math.floor((timeLeft % (1000 * 60)) / 1000)).padStart(2,"0")

                // Result is output to the specific element
                document.getElementById("countDown").innerHTML = `${hours}:${minutes}:${seconds}`

                // Display the message when countdown is over
                if (timeLeft <= 0) {
                    clearInterval()
                    document.getElementById("countDown").innerHTML ="B&Aring;DEN ER ANKOMMET!!"
                }
            },1000)
        }
        function parseTime( t ) {
            let d = new Date();
            let time = t.match( /(\d+)(?::(\d\d))?\s*(p?)/ );
            d.setHours( parseInt( time[1]) + (time[3] ? 12 : 0) );
            d.setMinutes( parseInt( time[2]) || 0 );
            return d;
        }

    </script>
    <script>
        //SCRIPT TIL KORT OG FUNKTIONER TIL KORT
        let startCoords = [55.3205449,15.1883541]

        //Denne linje sørger for at leaflet viser din position
        //let map = L.map('map', {doubleClickZoom: false}).locate({setView: true, maxZoom: 16});

        let map = L.map('map').setView(startCoords,16)
        const attribution = '&copy <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributers'
        const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
        const tiles = L.tileLayer(tileUrl,{ attribution/*, minZoom: 16*/ })
        tiles.addTo(map)
        let attractions=[]
        let markers=[]

        let route0_coords = [
            [55.320783, 15.186147],
            [55.320865, 15.186308],
            [55.320914, 15.186443],
            [55.320919, 15.187355],
            [55.320851, 15.187840],
            [55.321360, 15.189657],
            [55.320560, 15.189646],
            [55.320221, 15.189061],
            [55.319913, 15.189120],
            [55.319516, 15.188455],
            [55.319243, 15.187435],
            [55.319317, 15.186718],
            [55.320229, 15.186411]
        ]
        let route0=L.polyline(route0_coords, {color: 'red'})
        let routes=[route0]

        function showRoute(routeIndex){
            routes[routeIndex].addTo(map)
            let button= document.getElementById("route"+routeIndex+"Button")
            button.onclick=()=>hideRoute(routeIndex)
            button.innerText="Skjul"
        }

        function hideRoute(routeIndex){
            routes[routeIndex].remove()
            let button= document.getElementById("route"+routeIndex+"Button")
            button.onclick=()=>showRoute(routeIndex)
            button.innerText="Vis"
        }

		function attractionToHTML(a){
			let interestPoints=a.interestPoints?`(${a.interestPoints})`:""
			let timeToBoat=a.timeToBoat?`(${a.timeToBoat} min. til b&aring;den)<br>`:""
			let description=a.description?a.description:"(Der er ingen beskrivelse)"
			let image=a.imagefilename?`<br><img src="images/${a.imagefilename}" width="40%"/>`:""
			let sound=a.soundfilename?`<br><audio controls>
				<source src="sounds/${a.soundfilename}" type="audio/mpeg">
			</audio>`:""
			return `<p>
				<b>${a.name}</b> ${interestPoints}<br>
				${timeToBoat}
				${description}<br>
				(${a.latitude}, ${a.longtitude})
				${image}
				${sound}
			</p>`
		}

        function attractionToMarker(attraction){
            let coords = [attraction.latitude,attraction.longtitude]
            let popup = L.popup().setContent(`<b>${attraction.name}</b>`)
            let marker = L.marker(coords,{title:attraction.name})
                    .on('click',()=>{
						document.getElementById("data-cell").innerHTML=attractionToHTML(attraction)
                    	/*indsæt modal kald*/
                    })
                    .addTo(map)
                    .bindPopup(popup).openPopup()
            markers.push(marker)
        }
        let workRoute=L.polyline([], {color: 'red'})

        function enableRouteEdit(){
            workRoute=L.polyline([], {color: 'red'})
            workRoute.addTo(map)
            map.on("click",(e)=>{
                let coords=map.mouseEventToLatLng(e.originalEvent)
                workRoute.addLatLng([coords.lat,coords.lng])
            })
            let button=document.getElementById("routeEdit")
            button.onclick=saveWorkRoute
            button.innerText="Gem Rute"
        }

        function saveWorkRoute(){
            document.getElementById("map").onclick=()=>{}
            map.removeLayer(workRoute)
            let newIndex=routes.length
            routes.push(workRoute)
            let button=document.getElementById("routeEdit")
            button.onclick=enableRouteEdit
            button.innerText="Ny Rute"
            let routeList=document.getElementById("routeList")
            routeList.innerHTML+=`<tr id="route${newIndex}">
                    <td>Rute ${newIndex}</td>
                    <td>
                        <button id="route${newIndex}Button" onclick="showRoute(${newIndex})" class="btn btn-primary">Vis</button>
                    </td>
                </tr>`
        }
    </script>
</html>

